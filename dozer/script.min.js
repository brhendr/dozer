function startGame(a){function s(a,s){for(i=0;i<a.height;i++)for(j=0;j<a.width;j++)s.append('<div class="box" id="'+j+"-"+i+'"></div>');boxWidth=100/a.width+"%",$(".box").width(boxWidth),e(a),c(a),$(document).keydown(function(s){(38==s.which||39==s.which||40==s.which||37==s.which)&&(s.preventDefault(),o(s.which,a))})}function e(){$(".box").height($(".box").width())}function o(a,s){var e=$(".active").attr("id");e=e.split("-"),e[0]=parseInt(e[0]),e[1]=parseInt(e[1]),38==a?0!=e[1]&&(e[1]=e[1]-1,t(e[0]+"-"+e[1],"up")):39==a?e[0]!=s.width-1&&(e[0]=e[0]+1,t(e[0]+"-"+e[1],"right")):40==a?e[1]!=s.height-1&&(e[1]=e[1]+1,t(e[0]+"-"+e[1],"down")):37==a&&0!=e[0]&&(e[0]=e[0]-1,t(e[0]+"-"+e[1],"left"))}function t(a,s){$("#"+a).hasClass("rock")?l(a,s):$("#"+a).hasClass("wall")||($(".active").removeClass("active").removeClass("up").removeClass("down").removeClass("right").removeClass("left"),$("#"+a).addClass("active").addClass(s))}function l(a,s){var e=$("#"+a).attr("id");switch(pos=e.split("-"),pos[0]=parseInt(pos[0]),pos[1]=parseInt(pos[1]),s){case"up":pos[1]=pos[1]-1;var o=pos[0]+"-"+pos[1];-1!=pos[1]&&r(o,a,s);break;case"down":pos[1]=pos[1]+1;var o=pos[0]+"-"+pos[1];pos[1]!=h.height&&r(o,a,s);break;case"right":pos[0]=pos[0]+1;var o=pos[0]+"-"+pos[1];pos[0]!=h.width&&r(o,a,s);break;case"left":pos[0]=pos[0]-1;var o=pos[0]+"-"+pos[1];-1!=pos[0]&&r(o,a,s);break;default:console.log("error")}}function r(a,s,e){var o=$("#"+a);o.hasClass("wall")||o.hasClass("rock")||($("#"+s).removeClass("rock"),o.addClass("rock"),$(".active").removeClass("active").removeClass("up").removeClass("down").removeClass("right").removeClass("left"),$("#"+s).addClass("active").addClass(e),n())}function n(){var s=$(".goal").length,e=$(".goal.rock").length;if(s==e){var o=confirm("You Win! Are you ready for the next level?");o&&(a++,window.location.href="index.html?"+a)}}function c(a){for(var s=0;s<a.walls.length;s++)$("#"+a.walls[s]).addClass("wall");for(var s=0;s<a.rocks.length;s++)$("#"+a.rocks[s]).addClass("rock");for(var s=0;s<a.goals.length;s++)$("#"+a.goals[s]).addClass("goal");$("#"+a.start).addClass("active").addClass("right")}$(".level-number").html(a);var d=$("#map");$(document).unbind("keydown"),d.html("");var h;$.getJSON("levels/"+a+".json",function(a){s(a,d),h=a}).fail(function(){alert("Level Not Found, back to level 1..."),startGame(1)}),$(window).resize(function(){e()})}var query=window.location.search.slice(1),gameLevel=query.trimLeft("/");startGame(""==gameLevel?1:gameLevel),$("button").on("click",function(){startGame(gameLevel)});